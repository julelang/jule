# Release Guide

> [!WARNING]
> This documentation is intended for maintainers.

This documentation describes how the processes should be managed before a Jule release is published.\
A maintainer is responsible for following these processes when publishing a release.

## Preparation

- The `Version` constant in the `std/jule` package must be set correctly.
- [julec-ir](https://github.com/julelang/julec-ir) must be updated to the latest IR version, including the steps mentioned above.
- The Manual must be fully updated according to the latest release (do not forget to update the version table in the [backend](https://manual.jule.dev/compiler/backend/) section).
- During the build process, the compilation commands generated by the `--opt L2 -p` combination must be used; accordingly, the commands used under `.devcontainers/release` must be up to date.

**Make sure the required dependencies are installed:**\
For building;
- Apple Clang is used on macOS (comes with Apple Command Line Tools)
- Clang on Linux
- MinGW-Clang on Windows.

For packaging;
- The source code (without `git`) corresponding to the commit from which the release build will be produced is required.

## Build

This stage is about building the compiler and obtaining the executable binary.

### macOS

> [!NOTE]
> For macOS, a native machine or a VM should be used.
>
> It is recommended to build on an Apple Silicon (ARM64) system.\
> Building for Intel (AMD64) using Apple Clang should be straightforward, pass the `-arch x86_64` flag to the compiler.

- Obtain the latest IR code for the target platform and architecture using [julec-ir](https://github.com/julelang/julec-ir).
- Build the IR within the source code prepared during the preparation stage.

> [!TIP]
> On macOS, static linking is not required, as all dependencies should be available internally in a standard macOS installation.

### Windows

> [!NOTE]
> For Windows, a native machine or a VM should be used.\
>
> It is recommended to build on an ARM64 system.\
> Building for Intel (AMD64) using MinGW-Clang should be straightforward, use the correct binary like `x86_64-w64-mingw32-clang++`.

- Obtain the latest IR code for the target platform and architecture using [julec-ir](https://github.com/julelang/julec-ir).
- Build the IR within the source code prepared during the preparation stage.

> [!WARNING]
> Make sure the build is statically linked.
> Otherwise, on some systems the compiler may fail to run due to missing dependencies such as DLLs, making it unusable.

### Linux (devcontainers)

On Linux, the automated build process located under `.devcontainers/release` is used.
This process fetches and builds the latest IR versions compiled for Linux via the [julec-ir](https://github.com/julelang/julec-ir) repository.
The executable file is added to the directory where you run the script, named according to the platform–architecture combination (for example, `julec-linux-amd64`).

It is recommended to run the script from the root directory of the source code.

Like this: `sh ./.devcontainers/release/build.sh`

## Packaging

- Place the compiler binaries inside the source code obtained during the preparation phase at `bin/julec`.
- Make sure that no build artifacts (such as IR files) remain in the source tree.
- Name the source code directory `jule`.
- Compress the directory as a ZIP archive. The archive should be named in the format **version-platform-architecture** (for example, `jule0.2.0-darwin-arm64`).

## Release

- Create a new release on GitHub.
- Create a new tag for the corresponding version, for example `jule0.2.0`.
- Add the release notes and attach the archives you prepared for each platform–architecture combination as release assets.
- Before publishing the release, publish the manual release for the corresponding version.
- Publish the release.

## Post Release

- The `Version` constant in the `std/jule` package must be set to the new planned version with `@master` tag, like `jule0.2.0 @master`.
- The manual is always updated against the `@master` branch. Therefore, a link to the released version should be added to the list of older versions in the [Foreword](https://manual.jule.dev/foreword) section.
- Update the `latest` and `current` options to the latest version of [setup-jule](https://github.com/julelang/setup-jule).
