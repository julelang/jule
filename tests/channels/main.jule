// Copyright 2024 The Jule Project Contributors. All rights reserved.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

fn rangeIteration() {
	c := make(chan int, 4)
	c <- 10
	c <- 20
	c <- 30
	c <- 40
	close(c)
	for x in c {
		println(x)
	}
}

fn unbuffered() {
	c := make(chan int)
	co fn() {
		c <- 20
	}()
	x, ok := <-c
	if !ok {
		panic("invalid receive")
	}
	if x != 20 {
		panic("invalida data")
	}
}

fn sendOnly() {
	c := make(chan<- int, 1)
	c <- 20
}

fn recvOnly() {
	c := fn(): <-chan int {
		c := make(chan int)
		close(c)
		ret c
	}()
	_, ok := <-c
	if ok {
		panic("invalid receive")
	}
}

fn blockingSelect() {
	a := make(chan bool)
	co fn() {
		a <- true
	}()
	select {
	| <-a:
	}
}

fn capacity() {
	mut ch := make(chan int, 90)
	if cap(ch) != 90 {
		panic("expected 90")
	}
	ch = make(chan int)
	if cap(ch) != 0 {
		panic("expected 0")
	}
	ch = nil
	if cap(ch) != 0 {
		panic("expected 0")
	}
}

fn main() {
	rangeIteration()
	unbuffered()
	sendOnly()
	recvOnly()
	blockingSelect()
	capacity()
}