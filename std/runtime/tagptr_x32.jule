// Copyright 2025 The Jule Project Contributors. All rights reserved.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

#build i386

// The number of bits stored in the numeric tag of a taggedPointer
const taggedPointerBits = 32

// On 32-bit systems, taggedPointer has a 32-bit pointer and 32-bit count.

// Created a taggedPointer from a pointer and a tag.
// Tag bits that don't fit in the result are discarded.
fn taggedPointerPack(ptr: *unsafe, tag: uintptr): taggedPointer {
	ret taggedPointer(uintptr(ptr))<<32 | taggedPointer(tag)
}

impl taggedPointer {
	// Pointer returns the pointer from a taggedPointer.
	fn pointer(*self): *unsafe {
		ret unsafe { (*unsafe)(uintptr(*self >> 32)) }
	}

	// Tag returns the tag from a taggedPointer.
	fn tag(*self): uintptr {
		ret uintptr(*self)
	}
}