// Copyright 2024 The Jule Project Contributors. All rights reserved.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use "std/sys"

extern use "<time.h>"

extern type clockid_t: int

extern unsafe fn clock_gettime(id: extern.clockid_t, mut tp: *extern.timespec): int

extern struct timespec{}

// Returns system-wide realtime clock in seconds and nanoseconds.
// The nanoseconds is not a second yet, always in range (0, 999999999).
fn timeNow(): (sec: i64, nsec: i64) {
	mut ts := sys::Timespec{}
	if unsafe { extern.clock_gettime(extern.clockid_t(_CLOCK_REALTIME), (*extern.timespec)(&ts)) } == -1 {
		panic("runtime: timeNow failed")
	}
	sec, nsec = i64(ts.Sec), i64(ts.Nsec)
	ret
}

fn nanotime(): i64 {
	mut ts := sys::Timespec{}
	if unsafe { extern.clock_gettime(extern.clockid_t(_CLOCK_MONOTONIC), (*extern.timespec)(&ts)) } == -1 {
		panic("runtime: nanotime failed")
	}
	ret i64(ts.Sec)*1000000000 + i64(ts.Nsec)
}