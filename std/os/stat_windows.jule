// Copyright 2024-2025 The Jule Programming Language.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use integ "std/jule/integrated"
use "std/sys"

fn stat(path: str)!: FileInfo {
	if path == "" {
		error(FSError.NotExist)
	}
	utf16Path := integ::UTF16FromStr(path)
	mut handle := sys::SysStat{}
	code := unsafe { sys::Wstat(&utf16Path[0], &handle) }
	if code == -1 {
		error(getLastFsError())
	}
	mut stat := FileInfo{}
	stat.size = unsafe { uint(handle.st_size) }
	if handle.st_mode&sys::S_IFDIR == sys::S_IFDIR {
		stat.mode |= fileinfoMode.Dir
	} else if handle.st_mode&sys::S_IFREG == sys::S_IFREG {
		stat.mode |= fileinfoMode.Reg
	}
	ret stat
}