// Copyright 2024 The Jule Project Contributors. All rights reserved.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use "std/integ/c"
use "std/internal/poll"
use "std/internal/sys/windows"
use "std/mem"
use "std/sys"

fn lastErrorCode(): sys::Errno {
	ret sys::Errno(sys::WSAGetLastError())
}

fn socket(domain: int, typ: int, proto: int)!: poll::NetHandle {
	ret sys::WSASocket(domain, typ, proto, nil, 0, windows::WSA_FLAG_OVERLAPPED|windows::WSA_FLAG_NO_HANDLE_INHERIT)?
}

fn handleprepare(handle: poll::NetHandle)! {
	// On Windows, overlapped mode is non-blocking and async.
	// Created sockets use WSA_FLAG_NO_HANDLE_INHERIT,
	// which is equals to CloseOnExec on UNIX.
	// Nothing to do.
}

fn init() {
	poll::InitWSA()
}