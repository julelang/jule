// Copyright 2024 The Jule Project Contributors. All rights reserved.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use "std/runtime"
use "std/sync"
use "std/sync/atomic"
use "std/testing"

#test
async fn testCond(t: &testing::T) {
	cond := sync::Cond.New(new(sync::Mutex))
	mut ready := new(bool)
	mut wg := &sync::WaitGroup{}
	wg.Add(1)
	co async fn() {
		cond.Lock().await
		for !*ready {
			cond.Wait().await
		}
		cond.Unlock()
		wg.Done()
	}()
	wg.Add(1)
	co async fn() {
		cond.Lock().await
		*ready = true
		cond.Signal()
		cond.Unlock()
		wg.Done()
	}()
	wg.Wait().await
	if !*ready {
		t.Errorf("condition did not set correctly")
	}
}